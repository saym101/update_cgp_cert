# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤ –≤ CommuniGate Pro

–≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç SSL-—Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã –¥–ª—è –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –¥–æ–º–µ–Ω–æ–≤ –≤ —Å–µ—Ä–≤–µ—Ä–µ **CommuniGate Pro** (CGP) —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤ **Let's Encrypt**. –¢–∞–∫–∂–µ –æ–Ω –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —Å –ª–æ–≥–∞–º–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –Ω–∞ email.

## üìå –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å
- –û–±–Ω–æ–≤–ª—è–µ—Ç **–∫–ª—é—á, —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –∏ —Ü–µ–ø–æ—á–∫—É —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤** –¥–ª—è —É–∫–∞–∑–∞–Ω–Ω—ã—Ö –¥–æ–º–µ–Ω–æ–≤ –≤ CGP.
- –õ–æ–≥–∏—Ä—É–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤ `/var/log/update_cgp_cert.log`.
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç email-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è** —Å –∏—Ç–æ–≥–∞–º–∏ —Ä–∞–±–æ—Ç—ã.
- –†–∞–±–æ—Ç–∞–µ—Ç —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –¥–æ–º–µ–Ω–∞–º–∏ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ.
- –ú–æ–∂–µ—Ç –±—ã—Ç—å –¥–æ–±–∞–≤–ª–µ–Ω –≤ `cron` –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤.

## üîß –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

## –í–∫–ª—é—á–∏—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ CLI –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –∞–¥—Ä–µ—Å–∞

Settings\Srvices\HTTPU –ø—Ä–æ–∫—Ä—É—Ç–∏—Ç—å –Ω–∏–∂–µ –¥–æ **–î–æ–ø. –ø—Ä–æ—Ç–æ–∫–æ–ª—ã** –ø–∞—Ä–∞–º–µ—Ç—Ä **CLI** —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å clients.

–£–∫–∞–∑–∞—Ç—å 127.0.0.1 –∫–∞–∫ –∫–ª–∏–µ–Ω—Ç—Å–∫–∏–π –∞–¥—Ä–µ—Å. **Settings\Network\Client IPs** 

–í–∫–ª—é—á–∏—Ç—å PKI Services
Settings\Domain\<NameDomain>\Security\SSL/TLS –ø–∞—Ä–∞–º–µ—Ç—Ä PKI Services —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤ Enabled.

### 1. –ö–æ–ø–∏—Ä—É–µ–º —Å–∫—Ä–∏–ø—Ç –∫ —Å–µ–±–µ
```
 wget https://github.com/saym101/update_cgp_cert/raw/refs/heads/main/update_cgp_cert.sh
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
–ü–µ—Ä–µ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ —Å–∫—Ä–∏–ø—Ç–µ:
```bash
DOMAINS=("stpserver.ru talabsk.ru zaweru.ru")  # –£–∫–∞–∂–∏—Ç–µ —Å–≤–æ–∏ –¥–æ–º–µ–Ω—ã
POSTMASTER_NAME="postmaster@stpserver.ru"
POSTMASTER_PASSWORD="Brqada123!"  # –£–∫–∞–∂–∏—Ç–µ —Å–≤–æ–π –ø–∞—Ä–æ–ª—å
NOTIFICATION_EMAIL="postmaster@stpserver.ru"
IP_CGP_SERVER="127.0.0.1"
CLI_PORT="8100"
SMTP_SERVER="127.0.0.1:25"
```

### 3. –î–∞–µ–º –ø—Ä–∞–≤–∞ –Ω–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
```bash
chmod +x update_cgp_cert.sh
```

### 4. –ó–∞–ø—É—Å–∫ —Å–∫—Ä–∏–ø—Ç–∞ –≤—Ä—É—á–Ω—É—é
```bash
./update_cgp_cert.sh
```

### 5. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫ —Ä–∞–∑ –≤ 60 –¥–Ω–µ–π —á–µ—Ä–µ–∑ systemd
–°–æ–∑–¥–∞–π—Ç–µ service-—Ñ–∞–π–ª /etc/systemd/system/update_cgp_cert.service:
```bash
[Unit]
Description=Update CommuniGate Pro SSL Certificates
After=network.target

[Service]
Type=oneshot
ExecStart=/path/to/update_cgp_cert.sh
```
–°–æ–∑–¥–∞–π—Ç–µ timer-—Ñ–∞–π–ª /etc/systemd/system/update_cgp_cert.timer:
```bash
[Unit]
Description=Run update_cgp_cert.sh every 60 days

[Timer]
OnBootSec=5min
OnUnitInactiveSec=6912000  # 80 –¥–Ω–µ–π –≤ —Å–µ–∫—É–Ω–¥–∞—Ö
Unit=update_cgp_cert.service

[Install]
WantedBy=timers.target
```
–ê–∫—Ç–∏–≤–∏—Ä—É–π—Ç–µ —Ç–∞–π–º–µ—Ä:
```bash
systemctl daemon-reload
systemctl enable --now update_cgp_cert.timer
```

## üìú –õ–æ–≥–∏ –∏ –æ—Ç–ª–∞–¥–∫–∞
–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Å–∫—Ä–∏–ø—Ç–∞ –ª–æ–≥-—Ñ–∞–π–ª –º–æ–∂–Ω–æ –Ω–∞–π—Ç–∏ –∑–¥–µ—Å—å:
```bash
cat /var/log/update_cgp_cert.log
```

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- **–ù–µ —Ö—Ä–∞–Ω–∏—Ç–µ –ø–∞—Ä–æ–ª—å –≤ –∫–æ–¥–µ!** –õ—É—á—à–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏–ª–∏ —Ö—Ä–∞–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å –≤ –∑–∞—â–∏—â—ë–Ω–Ω–æ–º —Ñ–∞–π–ª–µ.
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ **`postmaster` –∏–º–µ–µ—Ç –¥–æ—Å—Ç—É–ø –∫ API CommuniGate Pro**.

## üéØ TODO
- [ ] –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤ —á–µ—Ä–µ–∑ `certbot`
- [ ] –ü–æ–¥–¥–µ—Ä–∂–∫–∞ HTTPS-–∑–∞–ø—Ä–æ—Å–æ–≤ –¥–ª—è API CommuniGate Pro
- [ ] –õ–æ–≥ –∫–∞–∂–¥—ã–π —Ä–∞–∑ –Ω–æ–≤—ã–π –ø–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Å–∫—Ä–∏–ø—Ç–∞

---

üìå –ê–≤—Ç–æ—Ä: [–ê–ª–µ–∫—Å–∞–Ω–¥—Ä](https://github.com/saym101) | üöÄ [GitHub Repo](https://github.com/saym101/update_cgp_cert)

